<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>Set up your community â€” Meitheal</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    body {
      min-height: 100vh;
      background: var(--color-bg);
      color: var(--color-text);
      font-family: var(--font-family);
      margin: 0;
      padding: 0;
    }

    .page {
      max-width: 640px;
      margin: 0 auto;
      padding: var(--space-6) var(--space-5) var(--space-12);
    }

    .guide-header {
      text-align: center;
      padding: var(--space-8) 0 var(--space-6);
      border-bottom: 1px solid var(--color-border);
      margin-bottom: var(--space-8);
    }

    .guide-wordmark {
      font-family: var(--font-family-heading);
      font-size: 2.5rem;
      font-weight: var(--font-weight-bold);
      color: var(--color-primary);
      letter-spacing: -0.04em;
      line-height: 1;
      margin-bottom: var(--space-3);
    }

    .guide-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      margin-bottom: var(--space-2);
    }

    .guide-subtitle {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
    }

    /* Progress */
    .progress-wrap {
      margin-bottom: var(--space-8);
    }

    .progress-meta {
      display: flex;
      justify-content: space-between;
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      margin-bottom: var(--space-2);
      font-family: var(--font-family);
    }

    .progress-bar {
      height: 4px;
      background: var(--color-border);
      border-radius: var(--radius-full);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--color-primary);
      border-radius: var(--radius-full);
      transition: width 0.5s ease;
    }

    /* Steps */
    .steps {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    .step {
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: border-color var(--transition-base), opacity var(--transition-base);
    }

    .step.active {
      border-color: var(--color-primary);
    }

    .step.done {
      border-color: var(--color-status-accepted);
    }

    .step.locked {
      opacity: 0.45;
      pointer-events: none;
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-4);
      background: var(--color-bg-card);
    }

    .step.done .step-header {
      background: var(--color-status-accepted-bg);
    }

    .step-number {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-full);
      background: var(--color-border);
      color: var(--color-text-muted);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-family: var(--font-family);
      transition: background var(--transition-base), color var(--transition-base);
    }

    .step.active .step-number {
      background: var(--color-primary);
      color: white;
    }

    .step.done .step-number {
      background: var(--color-status-accepted);
      color: white;
    }

    .step-header-text { flex: 1; }

    .step-title {
      font-family: var(--font-family-heading);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      line-height: 1.2;
    }

    .step-desc {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      margin-top: 2px;
    }

    .step-done-tag {
      font-size: var(--font-size-xs);
      color: var(--color-status-accepted);
      font-weight: var(--font-weight-semibold);
      display: none;
    }

    .step.done .step-done-tag { display: block; }

    /* Step body */
    .step-body {
      padding: var(--space-5);
      border-top: 1px solid var(--color-border);
      display: none;
    }

    .step.active .step-body { display: block; }

    /* Instructions */
    .instructions {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      line-height: var(--line-height-relaxed);
      margin-bottom: var(--space-4);
    }

    .instructions ol, .instructions ul {
      padding-left: var(--space-5);
      margin: var(--space-3) 0;
    }

    .instructions li { margin-bottom: var(--space-2); }
    .instructions strong { color: var(--color-text); }

    .instructions code {
      background: var(--color-bg-muted);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      padding: 1px 5px;
      font-size: 0.85em;
      font-family: monospace;
    }

    .instructions a { color: var(--color-primary); }

    /* Key box */
    .key-box {
      background: var(--color-bg-muted);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--space-4);
      margin-bottom: var(--space-4);
    }

    .key-box-label {
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-muted);
      margin-bottom: var(--space-3);
      font-family: var(--font-family);
    }

    .key-row {
      display: flex;
      align-items: baseline;
      gap: var(--space-3);
      padding: var(--space-2) 0;
      border-bottom: 1px solid var(--color-border-light);
    }

    .key-row:last-child { border-bottom: none; }

    .key-name {
      font-family: monospace;
      font-size: var(--font-size-sm);
      color: var(--color-primary);
      flex-shrink: 0;
      min-width: 150px;
    }

    .key-hint {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
    }

    /* Note */
    .note {
      background: var(--color-primary-bg);
      border-left: 3px solid var(--color-primary);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      padding: var(--space-3) var(--space-4);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
      line-height: var(--line-height-relaxed);
    }

    /* Checklist */
    .checklist {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
      margin-bottom: var(--space-5);
    }

    .check-item {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
    }

    .check-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-top: 2px;
      accent-color: var(--color-primary);
      cursor: pointer;
      flex-shrink: 0;
    }

    .check-item label {
      font-size: var(--font-size-sm);
      color: var(--color-text);
      cursor: pointer;
      line-height: var(--line-height-normal);
    }

    .check-item label a {
      color: var(--color-primary);
      text-decoration: none;
    }

    .check-item label a:hover { text-decoration: underline; }

    /* Confirm button */
    .confirm-btn {
      width: 100%;
      padding: var(--space-4) var(--space-5);
      background: var(--color-primary);
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      font-family: var(--font-family-heading);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      transition: all var(--transition-base);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .confirm-btn:hover:not(:disabled) {
      background: var(--color-primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .confirm-btn:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      transform: none;
    }

    /* Deploy button */
    .deploy-wrap {
      text-align: center;
      padding: var(--space-4) 0 var(--space-5);
    }

    /* Env table */
    .env-table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-sm);
      margin-bottom: var(--space-4);
    }

    .env-table th {
      text-align: left;
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-muted);
      padding: var(--space-2) var(--space-3);
      border-bottom: 1px solid var(--color-border);
      font-family: var(--font-family);
    }

    .env-table td {
      padding: var(--space-2) var(--space-3);
      border-bottom: 1px solid var(--color-border-light);
      vertical-align: top;
    }

    .env-table td:first-child {
      font-family: monospace;
      color: var(--color-primary);
      font-size: 0.85em;
      white-space: nowrap;
    }

    .env-table td:last-child { color: var(--color-text-secondary); }

    /* Final */
    .final-cta {
      text-align: center;
      padding: var(--space-10) var(--space-4);
      border-top: 1px solid var(--color-border);
      margin-top: var(--space-6);
    }

    .final-emoji { font-size: 3rem; margin-bottom: var(--space-4); }

    .final-title {
      font-family: var(--font-family-heading);
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-text);
      margin-bottom: var(--space-2);
    }

    .final-desc {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      margin-bottom: var(--space-6);
    }

    .final-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-4) var(--space-8);
      background: var(--color-primary);
      color: white;
      border-radius: var(--radius-lg);
      font-family: var(--font-family-heading);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      text-decoration: none;
      transition: all var(--transition-base);
    }

    .final-btn:hover {
      background: var(--color-primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .reset-link {
      display: block;
      text-align: center;
      margin-top: var(--space-10);
      font-size: var(--font-size-xs);
      color: var(--color-text-light);
      cursor: pointer;
      text-decoration: underline;
    }

    /* What is Meitheal */
    .explainer {
      margin-bottom: var(--space-8);
    }

    .explainer-lead {
      font-size: var(--font-size-base);
      color: var(--color-text-secondary);
      line-height: var(--line-height-relaxed);
      margin-bottom: var(--space-5);
    }

    .explainer-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-4);
      margin-bottom: var(--space-6);
    }

    @media (max-width: 480px) {
      .explainer-cols { grid-template-columns: 1fr; }
    }

    .explainer-col {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
    }

    .explainer-col-title {
      font-family: var(--font-family);
      font-size: 10px;
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-muted);
      margin-bottom: var(--space-3);
    }

    .explainer-col ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .explainer-col li {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      line-height: var(--line-height-normal);
      padding-left: var(--space-4);
      position: relative;
    }

    .explainer-col li::before {
      content: 'â†’';
      position: absolute;
      left: 0;
      color: var(--color-primary);
      font-size: var(--font-size-xs);
    }

    .explainer-divider {
      border: none;
      border-top: 1px solid var(--color-border);
      margin: var(--space-6) 0;
    }

    /* Path toggle */
    .path-toggle {
      display: flex;
      gap: var(--space-2);
      margin-bottom: var(--space-8);
      background: var(--color-bg-muted);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-1);
    }

    .path-btn {
      flex: 1;
      padding: var(--space-3) var(--space-4);
      border: none;
      border-radius: var(--radius-md);
      background: transparent;
      font-family: var(--font-family);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .path-btn.active {
      background: var(--color-bg-card);
      color: var(--color-text);
      box-shadow: var(--shadow-sm);
    }

    /* CLI path */
    .cli-path { display: none; }
    .cli-path.visible { display: block; }

    .cli-step {
      margin-bottom: var(--space-6);
    }

    .cli-step-label {
      font-size: 10px;
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-muted);
      margin-bottom: var(--space-2);
      font-family: var(--font-family);
    }

    .cli-step-title {
      font-family: var(--font-family-heading);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      margin-bottom: var(--space-2);
    }

    .cli-step-desc {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      line-height: var(--line-height-relaxed);
      margin-bottom: var(--space-3);
    }

    .cli-step-desc a { color: var(--color-primary); }

    .cmd-block {
      position: relative;
      background: #0d0d0d;
      border: 1px solid #2a2a2a;
      border-radius: var(--radius-md);
      margin-bottom: var(--space-3);
    }

    .cmd-block pre {
      margin: 0;
      padding: var(--space-4);
      font-family: monospace;
      font-size: var(--font-size-sm);
      color: #e0e0e0;
      overflow-x: auto;
      line-height: 1.7;
    }

    .cmd-block pre .comment { color: #555; }
    .cmd-block pre .prompt  { color: #4b8cf5; user-select: none; }

    .cmd-copy {
      position: absolute;
      top: var(--space-2);
      right: var(--space-2);
      padding: 3px 10px;
      background: #2a2a2a;
      border: 1px solid #3a3a3a;
      border-radius: var(--radius-sm);
      font-family: var(--font-family);
      font-size: 11px;
      color: #999;
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .cmd-copy:hover { background: #3a3a3a; color: #fff; }
    .cmd-copy.copied { background: var(--color-status-accepted); color: white; border-color: var(--color-status-accepted); }

    .cli-note {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      line-height: var(--line-height-relaxed);
      padding: var(--space-3) var(--space-4);
      background: var(--color-primary-bg);
      border-left: 3px solid var(--color-primary);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      margin-bottom: var(--space-3);
    }

    .cli-divider {
      border: none;
      border-top: 1px solid var(--color-border);
      margin: var(--space-6) 0;
    }

    /* AI provider section */
    .ai-section {
      margin-bottom: var(--space-5);
    }

    .ai-section-title {
      font-family: var(--font-family);
      font-size: 10px;
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-muted);
      margin-bottom: var(--space-3);
    }

    .ai-intro {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      line-height: var(--line-height-relaxed);
      margin-bottom: var(--space-4);
    }

    .ai-providers {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
    }

    .ai-provider {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      background: var(--color-bg-card);
      text-decoration: none;
    }

    .ai-provider:hover {
      border-color: var(--color-primary);
      background: var(--color-primary-bg);
    }

    .ai-provider.recommended {
      border-color: var(--color-status-accepted);
      background: var(--color-status-accepted-bg);
    }

    .ai-provider-name {
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      flex: 1;
    }

    .ai-provider-model {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      font-family: monospace;
    }

    .ai-badge {
      font-size: 9px;
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 2px 6px;
      border-radius: var(--radius-full);
      background: var(--color-status-accepted);
      color: white;
      flex-shrink: 0;
    }

    .ai-badge.neutral {
      background: var(--color-border);
      color: var(--color-text-muted);
    }

    .ai-warning {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      line-height: var(--line-height-relaxed);
      padding: var(--space-3) var(--space-4);
      background: var(--color-bg-muted);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
    }

    /* CLI step progression */
    .cli-step { display: none; }
    .cli-step.cli-active { display: block; }
    .cli-step-footer {
      margin-top: var(--space-5);
      padding-top: var(--space-4);
      border-top: 1px solid var(--color-border);
    }
  </style>
</head>
<body>
  <div class="page">

    <header class="guide-header">
      <div class="guide-wordmark">Meitheal</div>
      <div class="guide-title">Set up your community platform</div>
      <div class="guide-subtitle">Your progress is saved automatically â€” come back any time</div>
    </header>

    <div class="explainer">
      <div class="explainer-lead">
        Meitheal <em>(pronounced meh-hal)</em> is a platform that gives your community a voice â€” and actually does something with it. Members submit ideas and report problems. An admin reviews them and decides which ones are worth taking forward. The ones that get approved are built by an AI agent directly into your community platform â€” new pages, new features, shaped entirely by what your community asked for.
      </div>
      <div class="explainer-cols">
        <div class="explainer-col">
          <div class="explainer-col-title">What your community gets</div>
          <ul>
            <li>A place to submit ideas, feedback, and problems</li>
            <li>A transparent process â€” every proposal is visible</li>
            <li>Features built from real requests, not guesswork</li>
            <li>A governance log so nothing happens behind closed doors</li>
          </ul>
        </div>
        <div class="explainer-col">
          <div class="explainer-col-title">What you get as admin</div>
          <ul>
            <li>Full control over what gets approved and built</li>
            <li>A simple dashboard â€” no technical knowledge needed day to day</li>
            <li>A community that can see their ideas becoming reality</li>
          </ul>
        </div>
      </div>
      <hr class="explainer-divider">
      <div style="font-size:var(--font-size-sm);color:var(--color-text-muted);text-align:center;margin-bottom:var(--space-2)">
        Ready to set up your community? Follow the steps below â€” takes about 45 minutes.
      </div>
    </div>

    <!-- Path toggle -->
    <div class="path-toggle">
      <button class="path-btn active" id="btn-cli" onclick="setPath('cli')">Command line <span style="font-size:10px;opacity:0.7">(recommended)</span></button>
      <button class="path-btn" id="btn-browser" onclick="setPath('browser')">Browser guide</button>
    </div>

    <!-- CLI path -->
    <div class="cli-path visible" id="cli-path">

      <!-- Step 0: Prerequisites -->
      <div class="cli-step cli-active" id="cli-step-0">
        <div class="cli-step-label">Before you start</div>
        <div class="cli-step-title">What you need</div>
        <div class="cli-step-desc">
          You'll need free accounts on <a href="https://github.com/signup" target="_blank">GitHub â†—</a>,
          <a href="https://supabase.com/dashboard/sign-up" target="_blank">Supabase â†—</a>, and
          <a href="https://vercel.com/signup" target="_blank">Vercel â†—</a> â€” plus
          <strong>git</strong> and <strong>Node.js</strong> installed on your machine.
        </div>
        <details style="margin-top:var(--space-2)">
          <summary style="font-size:var(--font-size-sm);color:var(--color-primary);cursor:pointer;list-style:none;display:flex;align-items:center;gap:var(--space-2)">
            <span id="terminal-arrow" style="font-size:10px">â–¶</span> How do I open a terminal?
          </summary>
          <div style="margin-top:var(--space-3);display:flex;flex-direction:column;gap:var(--space-2)">
            <div style="font-size:var(--font-size-sm);color:var(--color-text-secondary);padding:var(--space-3) var(--space-4);background:var(--color-bg-muted);border:1px solid var(--color-border);border-radius:var(--radius-md)">
              <strong style="color:var(--color-text)">Mac</strong> â€” Press <kbd style="font-family:monospace;background:var(--color-border);padding:1px 5px;border-radius:3px">âŒ˜ Space</kbd>, type <em>Terminal</em>, press Enter
            </div>
            <div style="font-size:var(--font-size-sm);color:var(--color-text-secondary);padding:var(--space-3) var(--space-4);background:var(--color-bg-muted);border:1px solid var(--color-border);border-radius:var(--radius-md)">
              <strong style="color:var(--color-text)">Windows</strong> â€” Press <kbd style="font-family:monospace;background:var(--color-border);padding:1px 5px;border-radius:3px">Win</kbd>, type <em>PowerShell</em>, press Enter
            </div>
            <div style="font-size:var(--font-size-sm);color:var(--color-text-secondary);padding:var(--space-3) var(--space-4);background:var(--color-bg-muted);border:1px solid var(--color-border);border-radius:var(--radius-md)">
              <strong style="color:var(--color-text)">Linux</strong> â€” Press <kbd style="font-family:monospace;background:var(--color-border);padding:1px 5px;border-radius:3px">Ctrl Alt T</kbd>
            </div>
          </div>
        </details>
        <div class="cli-step-footer">
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="cli-chk-0-a" onchange="cliUpdateStep(0)">
              <label for="cli-chk-0-a">I have accounts on <a href="https://github.com/signup" target="_blank">GitHub â†—</a>, <a href="https://supabase.com/dashboard/sign-up" target="_blank">Supabase â†—</a>, and <a href="https://vercel.com/signup" target="_blank">Vercel â†—</a></label>
            </div>
            <div class="check-item">
              <input type="checkbox" id="cli-chk-0-b" onchange="cliUpdateStep(0)">
              <label for="cli-chk-0-b">I have <strong>git</strong> and <strong>Node.js</strong> installed</label>
            </div>
          </div>
          <button class="confirm-btn" id="cli-btn-0" onclick="cliCompleteStep(0)" disabled style="margin-top:var(--space-3)">
            Let's go <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 1: Install CLI tools -->
      <div class="cli-step" id="cli-step-1">
        <div class="cli-step-label">Step 1 of 6</div>
        <div class="cli-step-title">Install the CLI tools</div>
        <div class="cmd-block">
          <button class="cmd-copy" onclick="copyCmd(this)">Copy</button>
          <pre><span class="prompt">$ </span>npm install -g vercel supabase</pre>
        </div>
        <div class="cli-step-footer">
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="cli-chk-1" onchange="cliUpdateStep(1)">
              <label for="cli-chk-1">CLI tools installed â€” no errors in the terminal</label>
            </div>
          </div>
          <button class="confirm-btn" id="cli-btn-1" onclick="cliCompleteStep(1)" disabled style="margin-top:var(--space-3)">
            Next step <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 2: Fork and clone -->
      <div class="cli-step" id="cli-step-2">
        <div class="cli-step-label">Step 2 of 6</div>
        <div class="cli-step-title">Clone the platform into your own repo</div>
        <div class="cli-step-desc">
          First, <a href="https://github.com/RoryPeterRoberts/meitheal/fork" target="_blank">fork the repo on GitHub â†—</a>
          into your account. Then clone your fork:
        </div>
        <div class="cmd-block">
          <button class="cmd-copy" onclick="copyCmd(this)">Copy</button>
          <pre><span class="prompt">$ </span>git clone https://github.com/YOUR_USERNAME/meitheal my-community
<span class="prompt">$ </span>cd my-community</pre>
        </div>
        <div class="cli-step-footer">
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="cli-chk-2" onchange="cliUpdateStep(2)">
              <label for="cli-chk-2">I've forked the repo and cloned it to my machine</label>
            </div>
          </div>
          <button class="confirm-btn" id="cli-btn-2" onclick="cliCompleteStep(2)" disabled style="margin-top:var(--space-3)">
            Next step <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 3: Supabase project + migrations -->
      <div class="cli-step" id="cli-step-3">
        <div class="cli-step-label">Step 3 of 6</div>
        <div class="cli-step-title">Create your Supabase project and run migrations</div>
        <div class="cli-step-desc">
          Go to <a href="https://supabase.com/dashboard" target="_blank">supabase.com/dashboard â†—</a>
          and create a new project. Once ready, note your <strong>project ref</strong>
          (the part before <code>.supabase.co</code> in your project URL â€” e.g. <code>abcdefgh</code>).
          Then:
        </div>
        <div class="cmd-block">
          <button class="cmd-copy" onclick="copyCmd(this)">Copy</button>
          <pre><span class="prompt">$ </span>supabase login
<span class="prompt">$ </span>supabase link --project-ref YOUR_PROJECT_REF
<span class="prompt">$ </span>supabase db push</pre>
        </div>
        <div class="cli-note">
          This runs all the database migrations automatically â€” no SQL editor needed.
        </div>
        <div class="cli-step-footer">
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="cli-chk-3" onchange="cliUpdateStep(3)">
              <label for="cli-chk-3">Supabase project created and <code>db push</code> completed without errors</label>
            </div>
          </div>
          <button class="confirm-btn" id="cli-btn-3" onclick="cliCompleteStep(3)" disabled style="margin-top:var(--space-3)">
            Next step <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 4: Configure environment -->
      <div class="cli-step" id="cli-step-4">
        <div class="cli-step-label">Step 4 of 6</div>
        <div class="cli-step-title">Configure your environment</div>
        <div class="cli-step-desc">
          Copy the example env file and fill in your values. You'll find your Supabase keys at
          <a href="https://supabase.com/dashboard" target="_blank">supabase.com/dashboard â†—</a>
          â†’ Project Settings â†’ API. Your GitHub token comes from
          <a href="https://github.com/settings/tokens/new" target="_blank">github.com/settings/tokens â†—</a>
          (repo scope, no expiry).
        </div>
        <div class="cmd-block">
          <button class="cmd-copy" onclick="copyCmd(this)">Copy</button>
          <pre><span class="prompt">$ </span>cp .env.example .env.local
<span class="comment"># Open .env.local and fill in your Supabase keys, GitHub token, and AI key</span></pre>
        </div>
        <div class="cli-step-footer">
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="cli-chk-4" onchange="cliUpdateStep(4)">
              <label for="cli-chk-4">I've filled in <code>.env.local</code> with all required values</label>
            </div>
          </div>
          <button class="confirm-btn" id="cli-btn-4" onclick="cliCompleteStep(4)" disabled style="margin-top:var(--space-3)">
            Next step <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 5: Deploy -->
      <div class="cli-step" id="cli-step-5">
        <div class="cli-step-label">Step 5 of 6</div>
        <div class="cli-step-title">Deploy to Vercel</div>
        <div class="cmd-block">
          <button class="cmd-copy" onclick="copyCmd(this)">Copy</button>
          <pre><span class="prompt">$ </span>vercel login
<span class="prompt">$ </span>vercel --prod</pre>
        </div>
        <div class="cli-step-desc">
          Vercel will give you a URL like <code>my-community.vercel.app</code>.
        </div>
        <div class="cli-step-footer">
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="cli-chk-5" onchange="cliUpdateStep(5)">
              <label for="cli-chk-5">My platform is live at a Vercel URL</label>
            </div>
          </div>
          <button class="confirm-btn" id="cli-btn-5" onclick="cliCompleteStep(5)" disabled style="margin-top:var(--space-3)">
            Next step <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 6: Setup wizard -->
      <div class="cli-step" id="cli-step-6">
        <div class="cli-step-label">Step 6 of 6</div>
        <div class="cli-step-title">Run the setup wizard</div>
        <div class="cli-step-desc">
          Open your deployment URL and add <code>/setup.html</code>:
        </div>
        <div class="cmd-block">
          <button class="cmd-copy" onclick="copyCmd(this)">Copy</button>
          <pre><span class="prompt">$ </span>open https://my-community.vercel.app/setup.html</pre>
        </div>
        <div class="cli-step-desc">
          Fill in your community name, admin email, and AI provider. A sign-in link will arrive by email â€” click it and you're in as admin.
        </div>
        <div class="cli-step-footer">
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="cli-chk-6-a" onchange="cliUpdateStep(6)">
              <label for="cli-chk-6-a">I've completed the setup wizard and received my sign-in link</label>
            </div>
            <div class="check-item">
              <input type="checkbox" id="cli-chk-6-b" onchange="cliUpdateStep(6)">
              <label for="cli-chk-6-b">I've signed in and can see my admin panel</label>
            </div>
          </div>
          <button class="confirm-btn" id="cli-btn-6" onclick="cliCompleteStep(6)" disabled style="margin-top:var(--space-3)">
            Setup complete â€” let's go! <span>ðŸŽ‰</span>
          </button>
        </div>
      </div>

      <!-- Final CTA -->
      <div class="final-cta" id="cli-final" style="display:none">
        <div class="final-emoji">ðŸŽ‰</div>
        <div class="final-title">That's it â€” your community platform is live</div>
        <div class="final-desc">Invite your first members and start gathering ideas.</div>
        <a href="/home.html" class="final-btn">Go to your community â†’</a>
      </div>

    </div><!-- end cli-path -->

    <div id="browser-path" style="display:none">
    <div class="progress-wrap">
      <div class="progress-meta">
        <span id="progress-label">Step 1 of 5</span>
        <span id="progress-pct">0% complete</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill" style="width:0%"></div>
      </div>
    </div>

    <div class="steps">

      <!-- Step 1: Accounts -->
      <div class="step" id="step-1">
        <div class="step-header">
          <div class="step-number">1</div>
          <div class="step-header-text">
            <div class="step-title">Create your accounts</div>
            <div class="step-desc">Three free services â€” takes about 5 minutes</div>
          </div>
          <div class="step-done-tag">âœ“ Done</div>
        </div>
        <div class="step-body">
          <div class="instructions">
            Meitheal uses three free services to run your platform. Sign up to each one â€” you'll need all three before continuing.
          </div>
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="chk-github" onchange="updateBtn(1)">
              <label for="chk-github"><a href="https://github.com/signup" target="_blank">Sign up to GitHub â†—</a> â€” stores your community's platform code</label>
            </div>
            <div class="check-item">
              <input type="checkbox" id="chk-supabase" onchange="updateBtn(1)">
              <label for="chk-supabase"><a href="https://supabase.com/dashboard/sign-up" target="_blank">Sign up to Supabase â†—</a> â€” your community's database and login system</label>
            </div>
            <div class="check-item">
              <input type="checkbox" id="chk-vercel" onchange="updateBtn(1)">
              <label for="chk-vercel"><a href="https://vercel.com/signup" target="_blank">Sign up to Vercel â†—</a> â€” hosts your platform on the web</label>
            </div>
          </div>
          <button class="confirm-btn" id="btn-1" onclick="completeStep(1)" disabled>
            I have all three accounts <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 2: Supabase -->
      <div class="step locked" id="step-2">
        <div class="step-header">
          <div class="step-number">2</div>
          <div class="step-header-text">
            <div class="step-title">Set up your database</div>
            <div class="step-desc">Create a Supabase project and save your keys</div>
          </div>
          <div class="step-done-tag">âœ“ Done</div>
        </div>
        <div class="step-body">
          <div class="instructions">
            Supabase is where your members, feedback, and proposals are stored. Follow these steps:
            <ol>
              <li>Go to <a href="https://supabase.com/dashboard" target="_blank">supabase.com/dashboard â†—</a> and click <strong>New project</strong></li>
              <li>Give it a name â€” e.g. <em>Your Community Name</em></li>
              <li>Set a strong database password and save it somewhere safe</li>
              <li>Choose the region closest to your community</li>
              <li>Click <strong>Create new project</strong> and wait about 60 seconds</li>
            </ol>
            Once ready, go to <strong>Project Settings â†’ API</strong> and copy these three values:
          </div>
          <div class="key-box">
            <div class="key-box-label">From Supabase â†’ Project Settings â†’ API</div>
            <div class="key-row">
              <div class="key-name">Project URL</div>
              <div class="key-hint">Looks like <code>https://abcdefgh.supabase.co</code></div>
            </div>
            <div class="key-row">
              <div class="key-name">anon / public key</div>
              <div class="key-hint">Long string starting with <code>eyJâ€¦</code></div>
            </div>
            <div class="key-row">
              <div class="key-name">service_role key</div>
              <div class="key-hint">Another long string â€” keep this one private</div>
            </div>
          </div>
          <div class="instructions" style="margin-top:var(--space-4)">
            While you're in the Supabase dashboard, also get an <strong>Access Token</strong> â€” this lets the setup wizard create your database automatically, so you don't have to run any SQL manually.
            <ol>
              <li>Go to <a href="https://supabase.com/dashboard/account/tokens" target="_blank">supabase.com/dashboard/account/tokens â†—</a></li>
              <li>Click <strong>Generate new token</strong></li>
              <li>Give it a name like <em>Meitheal setup</em> and copy it</li>
            </ol>
          </div>
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="chk-sb-project" onchange="updateBtn(2)">
              <label for="chk-sb-project">I've created my Supabase project</label>
            </div>
            <div class="check-item">
              <input type="checkbox" id="chk-sb-keys" onchange="updateBtn(2)">
              <label for="chk-sb-keys">I've copied and saved my Project URL, anon key, and service_role key</label>
            </div>
            <div class="check-item">
              <input type="checkbox" id="chk-sb-token" onchange="updateBtn(2)">
              <label for="chk-sb-token">I've generated and saved my <a href="https://supabase.com/dashboard/account/tokens" target="_blank">Supabase Access Token â†—</a></label>
            </div>
          </div>
          <button class="confirm-btn" id="btn-2" onclick="completeStep(2)" disabled>
            My Supabase project is ready <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 3: GitHub Token -->
      <div class="step locked" id="step-3">
        <div class="step-header">
          <div class="step-number">3</div>
          <div class="step-header-text">
            <div class="step-title">Get a GitHub token</div>
            <div class="step-desc">Lets the AI agent build features into your platform</div>
          </div>
          <div class="step-done-tag">âœ“ Done</div>
        </div>
        <div class="step-body">
          <div class="instructions">
            When community ideas get approved, an AI agent builds them into your platform by writing code to GitHub. It needs permission to do this â€” a token gives it access.
            <ol>
              <li>Go to <a href="https://github.com/settings/tokens/new" target="_blank">GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens (classic) â†—</a></li>
              <li>Give it a name like <em>Meitheal agent</em></li>
              <li>Set expiry to <strong>No expiration</strong></li>
              <li>Tick the <strong>repo</strong> checkbox</li>
              <li>Click <strong>Generate token</strong></li>
              <li>Copy it immediately â€” you won't see it again</li>
            </ol>
          </div>
          <div class="note">
            Keep this token private. It gives write access to your repository. Don't share it or post it anywhere.
          </div>
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="chk-token" onchange="updateBtn(3)">
              <label for="chk-token">I've generated and saved my GitHub token</label>
            </div>
          </div>
          <button class="confirm-btn" id="btn-3" onclick="completeStep(3)" disabled>
            I have my GitHub token <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 4: Deploy -->
      <div class="step locked" id="step-4">
        <div class="step-header">
          <div class="step-number">4</div>
          <div class="step-header-text">
            <div class="step-title">Deploy your platform</div>
            <div class="step-desc">One click â€” then fill in your keys</div>
          </div>
          <div class="step-done-tag">âœ“ Done</div>
        </div>
        <div class="step-body">
          <div class="instructions">
            Click the button below. Vercel will:
            <ol>
              <li>Create a copy of the platform in your GitHub account</li>
              <li>Ask you to fill in your keys (use the table below as your guide)</li>
              <li>Deploy your platform live to a web address like <code>my-community.vercel.app</code></li>
            </ol>
            Nothing is installed on your computer. Everything runs in the cloud.
          </div>
          <div class="deploy-wrap">
            <a href="https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2FRoryPeterRoberts%2Fmeitheal&env=SUPABASE_URL,SUPABASE_ANON_KEY,SUPABASE_SERVICE_KEY,SUPABASE_ACCESS_TOKEN,GITHUB_TOKEN,GITHUB_REPO,GITHUB_BRANCH,AI_API_KEY&envDescription=You%27ll%20need%20your%20Supabase%20keys%20and%20a%20GitHub%20token.%20See%20the%20setup%20guide%20for%20each%20one.&envLink=https%3A%2F%2Fgithub.com%2FRoryPeterRoberts%2Fmeitheal%2Fblob%2Fmain%2FSETUP.md&project-name=my-community&repository-name=my-community" target="_blank">
              <img src="https://vercel.com/button" alt="Deploy with Vercel" style="height:36px">
            </a>
          </div>
          <div class="instructions">When Vercel asks for environment variables, enter the following:</div>
          <table class="env-table">
            <thead>
              <tr><th>Field</th><th>What to enter</th></tr>
            </thead>
            <tbody>
              <tr><td>SUPABASE_URL</td><td>Your Supabase Project URL from Step 2</td></tr>
              <tr><td>SUPABASE_ANON_KEY</td><td>Your Supabase anon/public key from Step 2</td></tr>
              <tr><td>SUPABASE_SERVICE_KEY</td><td>Your Supabase service_role key from Step 2</td></tr>
              <tr><td>GITHUB_TOKEN</td><td>Your GitHub token from Step 3</td></tr>
              <tr><td>GITHUB_REPO</td><td>Your GitHub username + <code>/my-community</code> â€” e.g. <code>janesmith/my-community</code></td></tr>
              <tr><td>GITHUB_BRANCH</td><td>Type <code>main</code></td></tr>
              <tr><td>SUPABASE_ACCESS_TOKEN</td><td>Your Supabase Access Token from Step 2 â€” lets the setup wizard create your database automatically</td></tr>
              <tr><td>AI_API_KEY</td><td>Your AI provider key â€” get this from the provider you choose below</td></tr>
            </tbody>
          </table>

          <div class="ai-section">
            <div class="ai-section-title">Choosing an AI provider</div>
            <div class="ai-intro">
              Think of Meitheal as the toaster and your AI provider as the electricity. The platform is all here â€” but it needs to be plugged in. The AI key connects it to a provider so the build agent can actually run and turn approved proposals into features. You'll need an account with one of these providers and a small amount of credit (most builds cost a few cents each).
            </div>
            <div class="ai-intro" style="margin-bottom:var(--space-3)">
              <strong>Use the latest model from any of these providers â€” latest always works best:</strong>
            </div>
            <div class="ai-providers">
              <a class="ai-provider recommended" href="https://platform.claude.com/settings/keys" target="_blank">
                <div class="ai-provider-name">Anthropic</div>
                <div class="ai-badge">Confirmed âœ“</div>
              </a>
              <a class="ai-provider recommended" href="https://platform.openai.com/api-keys" target="_blank">
                <div class="ai-provider-name">OpenAI</div>
                <div class="ai-badge">Confirmed âœ“</div>
              </a>
              <a class="ai-provider recommended" href="https://aistudio.google.com/apikey" target="_blank">
                <div class="ai-provider-name">Google</div>
                <div class="ai-badge">Confirmed âœ“</div>
              </a>
              <a class="ai-provider" href="https://platform.deepseek.com/api_keys" target="_blank">
                <div class="ai-provider-name">DeepSeek</div>
                <div class="ai-badge neutral">Available</div>
              </a>
              <a class="ai-provider" href="https://platform.moonshot.ai/console/api-keys" target="_blank">
                <div class="ai-provider-name">Kimi</div>
                <div class="ai-badge neutral">Available</div>
              </a>
              <a class="ai-provider" href="https://qwen.ai/apiplatform" target="_blank">
                <div class="ai-provider-name">Qwen (Alibaba)</div>
                <div class="ai-badge neutral">Available</div>
              </a>
              <a class="ai-provider" href="https://console.x.ai/" target="_blank">
                <div class="ai-provider-name">Grok (xAI)</div>
                <div class="ai-badge neutral">Available</div>
              </a>
            </div>
            <div class="ai-warning">
              âš  Always pick the latest / most capable model from your chosen provider. Smaller or "mini" variants may not produce reliable builds. If builds fail silently or produce errors, switching to the latest model is usually the fix.
            </div>
          </div>

          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="chk-deployed" onchange="updateBtn(4)">
              <label for="chk-deployed">Vercel shows <strong>Congratulations!</strong> and gives me a live URL</label>
            </div>
          </div>
          <button class="confirm-btn" id="btn-4" onclick="completeStep(4)" disabled>
            My platform is live <span>â†’</span>
          </button>
        </div>
      </div>

      <!-- Step 5: Setup Wizard -->
      <div class="step locked" id="step-5">
        <div class="step-header">
          <div class="step-number">5</div>
          <div class="step-header-text">
            <div class="step-title">Run the setup wizard</div>
            <div class="step-desc">Name your community and create your admin account</div>
          </div>
          <div class="step-done-tag">âœ“ Done</div>
        </div>
        <div class="step-body">
          <div class="instructions">
            Your platform is live but not yet configured. The setup wizard creates your database, names your community, and sets up your admin account.
            <ol>
              <li>Take your Vercel URL and add <code>/setup.html</code> â€” e.g. <code>my-community.vercel.app/setup.html</code></li>
              <li>Enter your community name, type, and your email address</li>
              <li>Click <strong>Set up community</strong></li>
              <li>Check your email â€” a sign-in link will arrive within a minute</li>
              <li>Click the link â€” you're in as admin</li>
            </ol>
          </div>
          <div class="note">
            If you see an error saying "Database not ready", wait 30 seconds and try again â€” your Supabase project may still be initialising.
          </div>
          <div class="checklist">
            <div class="check-item">
              <input type="checkbox" id="chk-wizard" onchange="updateBtn(5)">
              <label for="chk-wizard">I've completed the setup wizard and received my sign-in link</label>
            </div>
            <div class="check-item">
              <input type="checkbox" id="chk-signin" onchange="updateBtn(5)">
              <label for="chk-signin">I've signed in and can see my admin panel</label>
            </div>
          </div>
          <button class="confirm-btn" id="btn-5" onclick="completeStep(5)" disabled>
            Setup complete â€” let's go! <span>ðŸŽ‰</span>
          </button>
        </div>
      </div>

    </div>

    <!-- Final CTA -->
    <div id="final-cta" style="display:none">
      <div class="final-cta">
        <div class="final-emoji">ðŸŽ‰</div>
        <div class="final-title">Your community platform is live</div>
        <div class="final-desc">Invite your first members and start gathering ideas.</div>
        <a href="/home.html" class="final-btn">Go to your community â†’</a>
      </div>
    </div>

    <span class="reset-link" onclick="resetProgress()">Start over</span>

    </div><!-- end browser-path -->

  </div>

  <script>
    // ---- Path toggle ----
    function setPath(path) {
      const isCli = path === 'cli';
      document.getElementById('btn-cli').classList.toggle('active', isCli);
      document.getElementById('btn-browser').classList.toggle('active', !isCli);
      document.getElementById('cli-path').classList.toggle('visible', isCli);
      document.getElementById('browser-path').style.display = isCli ? 'none' : '';
    }

    // ---- Copy terminal command ----
    function copyCmd(btn) {
      const pre = btn.closest('.cmd-block').querySelector('pre');
      // Extract text, stripping the non-selectable prompt characters
      const text = Array.from(pre.childNodes)
        .filter(n => !n.classList?.contains('prompt'))
        .map(n => n.textContent)
        .join('')
        .trim();
      navigator.clipboard.writeText(text).then(() => {
        btn.textContent = 'Copied!';
        btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
      });
    }

    const TOTAL = 5;
    const CHECKS = {
      1: ['chk-github', 'chk-supabase', 'chk-vercel'],
      2: ['chk-sb-project', 'chk-sb-keys', 'chk-sb-token'],
      3: ['chk-token'],
      4: ['chk-deployed'],
      5: ['chk-wizard', 'chk-signin'],
    };

    function save() {
      const s = {};
      for (let i = 1; i <= TOTAL; i++) {
        s[`done_${i}`] = document.getElementById(`step-${i}`).classList.contains('done');
      }
      Object.values(CHECKS).flat().forEach(id => {
        const el = document.getElementById(id);
        if (el) s[id] = el.checked;
      });
      localStorage.setItem('meitheal_setup_v1', JSON.stringify(s));
    }

    function updateBtn(stepNum) {
      const allChecked = CHECKS[stepNum].every(id => document.getElementById(id)?.checked);
      document.getElementById(`btn-${stepNum}`).disabled = !allChecked;
      save();
    }

    function completeStep(stepNum) {
      const el = document.getElementById(`step-${stepNum}`);
      el.classList.remove('active', 'locked');
      el.classList.add('done');

      const next = document.getElementById(`step-${stepNum + 1}`);
      if (next) {
        next.classList.remove('locked');
        next.classList.add('active');
        setTimeout(() => next.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
      }

      if (stepNum === TOTAL) {
        document.getElementById('final-cta').style.display = 'block';
        setTimeout(() => document.getElementById('final-cta').scrollIntoView({ behavior: 'smooth' }), 100);
      }

      updateProgress();
      save();
    }

    function updateProgress() {
      const done = document.querySelectorAll('.step.done').length;
      const pct  = Math.round((done / TOTAL) * 100);
      document.getElementById('progress-fill').style.width = `${pct}%`;
      document.getElementById('progress-pct').textContent  = `${pct}% complete`;
      document.getElementById('progress-label').textContent =
        done === TOTAL ? 'All done!' : `Step ${Math.min(done + 1, TOTAL)} of ${TOTAL}`;
    }

    function resetProgress() {
      if (!confirm('Clear your progress and start over?')) return;
      localStorage.removeItem('meitheal_setup_v1');
      localStorage.removeItem('meitheal_cli_v1');
      location.reload();
    }

    // ---- CLI path progression ----
    const CLI_CHECKS = {
      0: ['cli-chk-0-a', 'cli-chk-0-b'],
      1: ['cli-chk-1'],
      2: ['cli-chk-2'],
      3: ['cli-chk-3'],
      4: ['cli-chk-4'],
      5: ['cli-chk-5'],
      6: ['cli-chk-6-a', 'cli-chk-6-b'],
    };
    const CLI_TOTAL = 6;

    function cliUpdateStep(stepNum) {
      const checks = CLI_CHECKS[stepNum] || [];
      const allDone = checks.every(id => document.getElementById(id)?.checked);
      const btn = document.getElementById(`cli-btn-${stepNum}`);
      if (btn) btn.disabled = !allDone;
    }

    function cliCompleteStep(stepNum) {
      try {
        const s = JSON.parse(localStorage.getItem('meitheal_cli_v1') || '{}');
        (CLI_CHECKS[stepNum] || []).forEach(id => { s[id] = true; });
        s[`done_${stepNum}`] = true;
        localStorage.setItem('meitheal_cli_v1', JSON.stringify(s));
      } catch (e) {}

      const next = stepNum + 1;
      if (next <= CLI_TOTAL) {
        const el = document.getElementById(`cli-step-${next}`);
        if (el) {
          el.classList.add('cli-active');
          setTimeout(() => el.scrollIntoView({ behavior: 'smooth', block: 'start' }), 200);
        }
      } else {
        const fin = document.getElementById('cli-final');
        if (fin) {
          fin.style.display = 'block';
          setTimeout(() => fin.scrollIntoView({ behavior: 'smooth' }), 200);
        }
      }
    }

    function cliRestoreProgress() {
      try {
        const s = JSON.parse(localStorage.getItem('meitheal_cli_v1') || '{}');
        let lastDone = -1;
        for (let i = 0; i <= CLI_TOTAL; i++) {
          if (s[`done_${i}`]) {
            (CLI_CHECKS[i] || []).forEach(id => {
              const el = document.getElementById(id);
              if (el) el.checked = true;
            });
            lastDone = i;
          }
        }
        // Show steps 0 through lastDone+1
        const showUpTo = Math.min(lastDone + 1, CLI_TOTAL);
        for (let i = 0; i <= showUpTo; i++) {
          const el = document.getElementById(`cli-step-${i}`);
          if (el) el.classList.add('cli-active');
        }
        if (s[`done_${CLI_TOTAL}`]) {
          const fin = document.getElementById('cli-final');
          if (fin) fin.style.display = 'block';
        }
        // Update all button states
        for (let i = 0; i <= CLI_TOTAL; i++) cliUpdateStep(i);
      } catch (e) {}
    }

    function init() {
      // Restore CLI progress
      cliRestoreProgress();

      // First step always active
      document.getElementById('step-1').classList.add('active');

      // Restore saved state
      try {
        const raw = localStorage.getItem('meitheal_setup_v1');
        if (!raw) return;
        const s = JSON.parse(raw);

        // Restore checkboxes
        Object.values(CHECKS).flat().forEach(id => {
          const el = document.getElementById(id);
          if (el && s[id]) el.checked = true;
        });

        // Restore completed steps in order
        for (let i = 1; i <= TOTAL; i++) {
          if (s[`done_${i}`]) {
            const el = document.getElementById(`step-${i}`);
            el.classList.remove('active', 'locked');
            el.classList.add('done');
            const next = document.getElementById(`step-${i + 1}`);
            if (next) { next.classList.remove('locked'); next.classList.add('active'); }
          }
          updateBtn(i);
        }

        if (s[`done_${TOTAL}`]) {
          document.getElementById('final-cta').style.display = 'block';
        }
      } catch (e) { /* ignore */ }

      updateProgress();
    }

    init();
  </script>
</body>
</html>
