<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">\n  <title>Noticeboard — Meitheal</title>\n  <link rel="stylesheet" href="theme.css">\n  <style>\n    .page {\n      max-width: 600px;\n      margin: 0 auto;\n      padding: 0 var(--space-5) var(--space-12);\n      min-height: 100vh;\n    }\n\n    .header {\n      padding: var(--space-6) 0 var(--space-4);\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      border-bottom: 1px solid var(--color-border);\n      margin-bottom: var(--space-6);\n    }\n\n    .back-link {\n      font-size: var(--font-size-sm);\n      color: var(--color-text-muted);\n      text-decoration: none;\n      display: flex;\n      align-items: center;\n      gap: var(--space-2);\n    }\n\n    .title {\n      font-family: var(--font-family-heading);\n      font-size: var(--font-size-2xl);\n      font-weight: var(--font-weight-bold);\n      color: var(--color-text);\n    }\n\n    .notice-form {\n      background: var(--color-bg-card);\n      border: 1px solid var(--color-border);\n      border-radius: var(--radius-lg);\n      padding: var(--space-4);\n      margin-bottom: var(--space-8);\n    }\n\n    .notice-form textarea {\n      width: 100%;\n      min-height: 80px;\n      padding: var(--space-3);\n      border: 1px solid var(--color-border);\n      border-radius: var(--radius-md);\n      font-family: inherit;\n      font-size: var(--font-size-sm);\n      resize: vertical;\n      margin-bottom: var(--space-3);\n      background: var(--color-bg);\n      color: var(--color-text);\n    }\n\n    .notice-form-footer {\n      display: flex;\n      justify-content: flex-end;\n    }\n\n    .post-btn {\n      padding: var(--space-2) var(--space-4);\n      background: var(--color-primary);\n      color: white;\n      border: none;\n      border-radius: var(--radius-md);\n      font-weight: var(--font-weight-semibold);\n      cursor: pointer;\n    }\n\n    .post-btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .notices-list {\n      display: flex;\n      flex-direction: column;\n      gap: var(--space-4);\n    }\n\n    .notice-card {\n      background: var(--color-bg-card);\n      border: 1px solid var(--color-border);\n      border-radius: var(--radius-lg);\n      padding: var(--space-4);\n      position: relative;\n    }\n\n    .notice-meta {\n      font-size: 11px;\n      color: var(--color-text-light);\n      margin-bottom: var(--space-2);\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .notice-content {\n      font-size: var(--font-size-sm);\n      line-height: var(--line-height-relaxed);\n      color: var(--color-text-secondary);\n      white-space: pre-wrap;\n    }\n\n    .delete-btn {\n      background: none;\n      border: none;\n      color: var(--color-status-hold);\n      font-size: 10px;\n      cursor: pointer;\n      padding: 4px;\n      opacity: 0.6;\n    }\n\n    .delete-btn:hover { opacity: 1; }\n\n    .empty-state {\n      text-align: center;\n      padding: var(--space-12) 0;\n      color: var(--color-text-muted);\n      font-style: italic;\n    }\n  </style>\n</head>\n<body>\n  <script src="/api/init"></script>\n  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>\n  <script src="supabase.js"></script>\n  <script src="js/auth.js"></script>\n  <script src="feedback-widget.js"></script>\n\n  <div class="page">\n    <header class="header">\n      <a href="home.html" class="back-link">← Back</a>\n      <h1 class="title">Noticeboard</h1>\n      <div style="width: 40px"></div><!-- balance -->\n    </header>\n\n    <div class="notice-form">\n      <textarea id="notice-input" placeholder="Post a notice to the community..."></textarea>\n      <div class="notice-form-footer">\n        <button id="post-btn" class="post-btn">Post Notice</button>\n      </div>\n    </div>\n\n    <div id="notices-list" class="notices-list">\n      <!-- Notices will be loaded here -->\n    </div>\n  </div>\n\n  <script>\n    let currentUser = null;\n\n    async function loadNotices() {\n      const list = document.getElementById('notices-list');\n      try {\n        const notices = await getNotices();\n        \n        if (notices.length === 0) {\n          list.innerHTML = '<div class="empty-state">No notices yet. Be the first to post!</div>';\n          return;\n        }\n\n        list.innerHTML = notices.map(notice => {\n          const date = new Date(notice.created_at).toLocaleDateString('en-IE', { \n            day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' \n          });\n          const isAuthor = currentUser && notice.author_id === currentUser.id;\n          \n          return `\n            <div class="notice-card">\n              <div class="notice-meta">\n                <span><strong>${notice.members?.display_name || 'Member'}</strong> • ${date}</span>\n                ${isAuthor ? `<button class="delete-btn" onclick="handleDelete('${notice.id}')">Delete</button>` : ''}\n              </div>\n              <div class="notice-content">${notice.content}</div>\n            </div>\n          `;\n        }).join('');\n      } catch (err) {\n        console.error(err);\n        list.innerHTML = '<div class="empty-state">Error loading notices.</div>';\n      }\n    }\n\n    async function handleDelete(id) {\n      if (!confirm('Are you sure you want to delete this notice?')) return;\n      try {\n        await deleteNotice(id);\n        loadNotices();\n      } catch (err) {\n        alert('Failed to delete notice.');\n      }\n    }\n\n    async function init() {\n      currentUser = await requireAuthAsync();\n      if (!currentUser) return;\n      \n      initFeedbackWidget(currentUser.id);\n      loadNotices();\n\n      const btn = document.getElementById('post-btn');\n      const input = document.getElementById('notice-input');\n\n      btn.addEventListener('click', async () => {\n        const content = input.value.trim();\n        if (!content) return;\n\n        btn.disabled = true;\n        btn.textContent = 'Posting...';\n\n        try {\n          await postNotice(currentUser.id, content);\n          input.value = '';\n          await loadNotices();\n        } catch (err) {\n          alert('Failed to post notice.');\n        } finally {\n          btn.disabled = false;\n          btn.textContent = 'Post Notice';\n        }\n      });\n    }\n\n    init();\n  </script>\n</body>\n</html>\n