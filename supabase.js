// ============================================================\n// MEITHEAL â€” SUPABASE CLIENT\n// Replace the values below with your project's URL and anon key,\n// or configure them via environment variables in Vercel.\n// ============================================================\n\nconst SUPABASE_URL      = window._SUPABASE_URL      || 'https://YOUR_PROJECT.supabase.co';\nconst SUPABASE_ANON_KEY = window._SUPABASE_ANON_KEY || 'YOUR_ANON_KEY';\n\nlet _sb = null;\nfunction getSupabase() {\n  if (!_sb) _sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\n  return _sb;\n}\n\n// ---- Feedback ----\n\nasync function createFeedbackRecord({ author_id, type, message }) {\n  const { data, error } = await getSupabase()\n    .from('feedback')\n    .insert([{ author_id, type, message }])\n    .select()\n    .single();\n  if (error) throw error;\n  return data;\n}\n\nasync function getMyFeedback(memberId) {\n  const { data, error } = await getSupabase()\n    .from('feedback')\n    .select('*')\n    .eq('author_id', memberId)\n    .order('created_at', { ascending: false });\n  if (error) throw error;\n  return data || [];\n}\n\nasync function getAllFeedback() {\n  const { data, error } = await getSupabase()\n    .from('feedback')\n    .select('*, members(display_name, email)')\n    .order('created_at', { ascending: true });\n  if (error) throw error;\n  return data || [];\n}\n\nasync function updateFeedback(id, updates) {\n  const { data, error } = await getSupabase()\n    .from('feedback')\n    .update(updates)\n    .eq('id', id)\n    .select()\n    .single();\n  if (error) throw error;\n  return data;\n}\n\n// ---- Proposals ----\n\nasync function createProposal({ feedback_id, title, description, promoted_by }) {\n  const { data, error } = await getSupabase()\n    .from('proposals')\n    .insert([{ feedback_id, title, description, promoted_by, status: 'proposed' }])\n    .select()\n    .single();\n  if (error) throw error;\n  return data;\n}\n\nasync function getAllProposals() {\n  const { data, error } = await getSupabase()\n    .from('proposals')\n    .select('*, members!proposals_promoted_by_fkey(display_name), feedback(message, ref_number, author_id)')\n    .order('created_at', { ascending: false });\n  if (error) throw error;\n  return data || [];\n}\n\nasync function getProposal(id) {\n  const { data, error } = await getSupabase()\n    .from('proposals')\n    .select('*, feedback(message, ref_number, author_id)')\n    .eq('id', id)\n    .single();\n  if (error) throw error;\n  return data;\n}\n\n// ---- Changelog ----\n\nasync function getChangelog() {\n  const { data, error } = await getSupabase()\n    .from('changelog')\n    .select('id, ts, description, files_changed, sql_run, suggested_by_name, proposal_id')\n    .order('ts', { ascending: false });\n  if (error) throw error;\n  return data || [];\n}\n\nasync function getPendingValidations(memberId) {\n  // proposals that are done but the original submitter hasn't validated yet\n  const { data, error } = await getSupabase()\n    .from('proposals')\n    .select('id, title, feedback!inner(author_id)')\n    .eq('status', 'done')\n    .is('member_validated', null)\n    .eq('feedback.author_id', memberId);\n  if (error) throw error;\n  return data || [];\n}\n\n// ---- Members ----\n\nasync function getAllMembers() {\n  const { data, error } = await getSupabase()\n    .from('members')\n    .select('id,display_name,email,role,trust_level,status,created_at')\n    .eq('status', 'active')\n    .order('created_at', { ascending: true });\n  if (error) throw error;\n  return data || [];\n}\n\n// ---- Settings ----\n\nasync function getSetting(key) {\n  const { data } = await getSupabase()\n    .from('settings')\n    .select('value')\n    .eq('key', key)\n    .single();\n  return data?.value || null;\n}\n\nasync function getCommunityName() {\n  return await getSetting('community_name') || 'Our Community';\n}\n\n// ---- Noticeboard ----\n\nasync function getNotices() {\n  const { data, error } = await getSupabase()\n    .from('notices')\n    .select('*, members(display_name)')\n    .order('created_at', { ascending: false });\n  if (error) throw error;\n  return data || [];\n}\n\nasync function postNotice(author_id, content) {\n  const { data, error } = await getSupabase()\n    .from('notices')\n    .insert([{ author_id, content }])\n    .select()\n    .single();\n  if (error) throw error;\n  return data;\n}\n\nasync function deleteNotice(id) {\n  const { error } = await getSupabase()\n    .from('notices')\n    .delete()\n    .eq('id', id);\n  if (error) throw error;\n}\n